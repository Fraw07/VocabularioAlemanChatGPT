<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Juego de vocabulario alemán</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#4CAF50">
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; margin: 0; background: #f5f5f5; color: #333; }
    h2 { text-align: center; }
    .hidden { display: none; }
    textarea, input {
      width: 100%; padding: 12px; font-size: 16px;
      border: 1px solid #ccc; border-radius: 8px; margin: 8px 0; box-sizing: border-box;
    }
    button {
      display: block; width: 100%; padding: 14px; font-size: 18px;
      border: none; border-radius: 10px; margin: 10px 0;
      background: #4CAF50; color: white; cursor: pointer;
    }
    button:hover { background: #45a049; }
    #question { font-size: 20px; margin-bottom: 10px; text-align: center; }
    #result { font-size: 20px; text-align: center; margin: 20px 0; }
  </style>
</head>
<body>
  <h2>Juego de vocabulario alemán</h2>

  <div id="input-section">
    <p>Introduce las palabras (formato: <i>artículo singular + palabra singular - artículo plural + palabra plural</i>)</p>
    <textarea id="word-list" rows="6" placeholder="das Auto - die Autos\ndas Buch - die Bücher\ndas Glas - die Gläser"></textarea>
    <button onclick="startGame()">Comenzar juego</button>
  </div>

  <div id="game-section" class="hidden">
    <p id="question"></p>
    <input type="text" id="answer-article" placeholder="Artículo singular">
    <input type="text" id="answer-plural" placeholder="Plural">
    <button onclick="checkAnswer()">Responder</button>
  </div>

  <div id="result-section" class="hidden">
    <p id="result"></p>
    <button onclick="playAgain()">🔄 Jugar otra vez con la misma lista</button>
    <button onclick="newList()">➕ Introducir nueva lista</button>
  </div>

  <script>
    let words = [], currentIndex = 0, score = 0, fails = 0, shuffled = [];

    function startGame() {
      const text = document.getElementById("word-list").value.trim();
      if (!text) return alert("Introduce al menos una palabra.");
      
      words = text.split("\\n").map(line => {
        const parts = line.split("-").map(p => p.trim());
        if (parts.length === 2) {
          const [sing, plur] = parts;
          const singParts = sing.split(" ");
          const article = singParts[0];
          const word = singParts.slice(1).join(" ");
          const plurParts = plur.split(" ");
          const articlePlural = plurParts[0];
          const wordPlural = plurParts.slice(1).join(" ");
          return { article, word, articlePlural, wordPlural };
        }
      }).filter(Boolean);

      if (words.length === 0) return alert("Formato incorrecto.");

      shuffled = shuffle([...words]);
      currentIndex = 0; score = 0; fails = 0;

      document.getElementById("input-section").classList.add("hidden");
      document.getElementById("game-section").classList.remove("hidden");
      document.getElementById("result-section").classList.add("hidden");
      showQuestion();
    }

    function showQuestion() {
      const w = shuffled[currentIndex];
      document.getElementById("question").innerText = `___ ${w.word} - ${w.articlePlural} _____`;
      document.getElementById("answer-article").value = "";
      document.getElementById("answer-plural").value = "";
      document.getElementById("answer-article").focus();
    }

    function checkAnswer() {
      const w = shuffled[currentIndex];
      const art = document.getElementById("answer-article").value.trim();
      const plur = document.getElementById("answer-plural").value.trim();

      if (art === w.article && plur === w.wordPlural) score++;
      else fails++;

      currentIndex++;
      if (currentIndex < shuffled.length) showQuestion();
      else endGame();
    }

    function endGame() {
      document.getElementById("game-section").classList.add("hidden");
      document.getElementById("result-section").classList.remove("hidden");
      document.getElementById("result").innerText = `✅ Aciertos: ${score}   ❌ Fallos: ${fails}`;
    }

    function playAgain() {
      shuffled = shuffle([...words]); currentIndex = 0; score = 0; fails = 0;
      document.getElementById("result-section").classList.add("hidden");
      document.getElementById("game-section").classList.remove("hidden");
      showQuestion();
    }

    function newList() {
      document.getElementById("word-list").value = "";
      document.getElementById("input-section").classList.remove("hidden");
      document.getElementById("game-section").classList.add("hidden");
      document.getElementById("result-section").classList.add("hidden");
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // Registrar service worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }
  </script>
</body>
</html>
