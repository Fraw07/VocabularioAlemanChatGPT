<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Juego de vocabulario alem√°n</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#4CAF50">
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; margin: 0; background: #f5f5f5; color: #333; }
    h2 { text-align: center; }
    .hidden { display: none; }
    textarea, input, select {
      width: 100%; padding: 12px; font-size: 16px;
      border: 1px solid #ccc; border-radius: 8px; margin: 8px 0; box-sizing: border-box;
    }
    button {
      display: block; width: 100%; padding: 14px; font-size: 18px;
      border: none; border-radius: 10px; margin: 10px 0;
      background: #4CAF50; color: white; cursor: pointer;
    }
    button:hover { background: #45a049; }
    #question { font-size: 20px; margin-bottom: 10px; text-align: center; }
    #feedback { font-size: 18px; text-align: center; margin: 10px 0; }
    #progress { font-size: 16px; text-align: center; margin: 10px 0; color: #555; }
  </style>
</head>
<body>
  <h2>Juego de vocabulario alem√°n</h2>

  <div id="menu-section">
    <p>Selecciona una lista guardada o crea una nueva:</p>
    <select id="saved-lists"></select>
    <button onclick="loadSelectedList()">üìÇ Cargar lista seleccionada</button>
    <button onclick="showNewListInput()">‚ûï Crear nueva lista</button>
    <button onclick="deleteSelectedList()">üóëÔ∏è Borrar lista seleccionada</button>
  </div>

  <div id="input-section" class="hidden">
    <p>Introduce las palabras (formato: <i>art√≠culo singular + palabra singular - art√≠culo plural + palabra plural</i>)</p>
    <textarea id="word-list" rows="6" placeholder="das Auto - die Autos\ndas Buch - die B√ºcher"></textarea>
    <input type="text" id="list-name" placeholder="Nombre de la lista">
    <button onclick="saveList()">üíæ Guardar y comenzar juego</button>
  </div>

  <div id="game-section" class="hidden">
    <p id="question"></p>
    <input type="text" id="answer-article" placeholder="Art√≠culo singular">
    <input type="text" id="answer-plural" placeholder="Plural">
    <button onclick="checkAnswer()">Responder</button>
    <p id="feedback"></p>
    <p id="progress"></p>
  </div>

  <div id="result-section" class="hidden">
    <p id="result"></p>
    <button onclick="playAgain()">üîÑ Jugar otra vez con la misma lista</button>
    <button onclick="showNewListInput()">‚ûï Introducir nueva lista</button>
  </div>

  <script>
    let words = [], currentIndex = 0, score = 0, fails = 0, shuffled = [], currentListName = "";

    // ---------- Manejo de listas ----------
    function populateSavedLists() {
      const select = document.getElementById("saved-lists");
      select.innerHTML = "";
      for (let key in localStorage) {
        if (key.startsWith("vocabList_")) {
          const list = JSON.parse(localStorage[key]);
          const option = document.createElement("option");
          option.value = key;
          option.text = `${list.name} (${list.words.length} palabras)`;
          select.add(option);
        }
      }
    }

    function showNewListInput() {
      document.getElementById("menu-section").classList.add("hidden");
      document.getElementById("input-section").classList.remove("hidden");
      document.getElementById("word-list").value = "";
      document.getElementById("list-name").value = "";
    }

    function saveList() {
      const text = document.getElementById("word-list").value.trim();
      const name = document.getElementById("list-name").value.trim();
      if (!text || !name) return alert("Introduce un nombre y al menos una palabra.");

      const parsedWords = text.split("\n").map(line => {
        const parts = line.split("-").map(p => p.trim());
        if (parts.length === 2) {
          const [sing, plur] = parts;
          const singParts = sing.split(" ");
          const article = singParts[0];
          const word = singParts.slice(1).join(" ");
          const plurParts = plur.split(" ");
          const articlePlural = plurParts[0];
          const wordPlural = plurParts.slice(1).join(" ");
          return { article, word, articlePlural, wordPlural };
        }
      }).filter(Boolean);

      if (parsedWords.length === 0) return alert("Formato incorrecto.");

      localStorage.setItem("vocabList_" + name, JSON.stringify({ name, words: parsedWords }));
      currentListName = name;
      startGame(parsedWords);
    }

    function loadSelectedList() {
      const select = document.getElementById("saved-lists");
      if (!select.value) return alert("Selecciona una lista.");
      const list = JSON.parse(localStorage[select.value]);
      currentListName = list.name;
      startGame(list.words);
    }

    function deleteSelectedList() {
      const select = document.getElementById("saved-lists");
      if (!select.value) return alert("Selecciona una lista.");
      if (confirm("¬øSeguro que quieres borrar esta lista?")) {
        localStorage.removeItem(select.value);
        populateSavedLists();
      }
    }

    // ---------- Juego ----------
    function startGame(list) {
      words = list;
      shuffled = shuffle([...words]);
      currentIndex = 0; score = 0; fails = 0;

      document.getElementById("menu-section").classList.add("hidden");
      document.getElementById("input-section").classList.add("hidden");
      document.getElementById("game-section").classList.remove("hidden");
      document.getElementById("result-section").classList.add("hidden");
      showQuestion();
    }

    function showQuestion() {
      const w = shuffled[currentIndex];
      document.getElementById("question").innerText = `___ ${w.word} - ${w.articlePlural} _____`;
      document.getElementById("answer-article").value = "";
      document.getElementById("answer-plural").value = "";
      document.getElementById("feedback").innerText = "";
      document.getElementById("progress").innerText = `Palabra ${currentIndex + 1} de ${shuffled.length}`;
      document.getElementById("answer-article").focus();
    }

    function checkAnswer() {
      const w = shuffled[currentIndex];
      const art = document.getElementById("answer-article").value.trim();
      const plur = document.getElementById("answer-plural").value.trim();
      const feedbackEl = document.getElementById("feedback");

      if (art === w.article && plur === w.wordPlural) {
        score++;
        feedbackEl.innerText = "‚úÖ Correcto!";
        feedbackEl.style.color = "green";
      } else {
        fails++;
        feedbackEl.innerText = `‚ùå Incorrecto. La respuesta correcta es: ${w.article} ${w.word} - ${w.articlePlural} ${w.wordPlural}`;
        feedbackEl.style.color = "red";
      }

      currentIndex++;
      if (currentIndex < shuffled.length) {
        setTimeout(showQuestion, 1500);
      } else {
        setTimeout(showResult, 1500);
      }
    }

    function showResult() {
      document.getElementById("game-section").classList.add("hidden");
      document.getElementById("result-section").classList.remove("hidden");
      document.getElementById("result").innerText = `¬°Juego terminado!\nAciertos: ${score}\nFallos: ${fails}`;
      populateSavedLists(); // refrescar men√∫ por si hay nuevas listas
    }

    function playAgain() {
      shuffled = shuffle([...words]);
      currentIndex = 0; score = 0; fails = 0;
      document.getElementById("result-section").classList.add("hidden");
      document.getElementById("game-section").classList.remove("hidden");
      showQuestion();
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // Inicializar men√∫
    populateSavedLists();

    // Registrar service worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }
  </script>
</body>
</html>